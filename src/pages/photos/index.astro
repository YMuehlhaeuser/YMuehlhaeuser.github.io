---
import BaseLayout from '../../layouts/BaseLayout.astro';

const allImages = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/photos/**/*.{jpg,jpeg,png,webp,JPG,JPEG,PNG,WEBP}',
  { eager: true }
);

// Derive albums and counts from folder names
const albumMap = new Map<string, number>();
for (const path of Object.keys(allImages)) {
  const folder = path.split('/').at(-2)!;
  albumMap.set(folder, (albumMap.get(folder) ?? 0) + 1);
}

const albums = [...albumMap.entries()].sort(([a], [b]) => a.localeCompare(b));
---

<BaseLayout title="Photos" description="A gallery of moments I've captured">
  <h1>Photos</h1>
  <p class="subtitle">Browse by album.</p>

  {albums.length === 0 ? (
    <p class="empty">No photos yet. Add subfolders to <code>src/assets/photos/</code>.</p>
  ) : (
    <ul class="album-grid">
      {albums.map(([album, count]) => (
        <li>
          <a href={`/photos/${album}`} class="album-card">
            <span class="album-name">{album.charAt(0).toUpperCase() + album.slice(1)}</span>
            <span class="album-count">{count} {count === 1 ? 'photo' : 'photos'}</span>
          </a>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>

<style>
  h1 { margin-top: 0; }

  .subtitle {
    color: var(--text-muted);
    margin-top: -0.5rem;
    margin-bottom: 2rem;
  }

  .album-grid {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 1rem;
  }

  .album-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    padding: 2rem 1rem;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    text-decoration: none;
    color: var(--text);
    transition: border-color 0.15s;
  }

  .album-card:hover { border-color: var(--accent); }

  .album-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--accent);
  }

  .album-count {
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  .empty {
    color: var(--text-muted);
    font-style: italic;
  }
</style>
